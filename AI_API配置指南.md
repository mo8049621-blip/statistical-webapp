# AI API 配置指南

## 为什么之前的网站没有接入真实的AI API？

之前的实现中，"AI生成数据"功能使用的是模拟数据而非真实的AI API，主要有以下几个原因：

1. **开发阶段的简化实现**：在开发和测试阶段，为了快速验证功能逻辑，使用了模拟数据生成函数
2. **缺少真实API调用的基础设施**：代码中没有包含与DashScope API通信的HTTP请求逻辑
3. **配置管理不完善**：虽然.env文件中包含了API密钥，但没有统一的配置管理机制
4. **错误处理机制缺失**：缺少针对API调用可能出现的各种错误的处理逻辑

## 我们做了哪些更改来支持真实的AI API？

我已经对代码进行了全面修改，添加了以下功能来支持真实的AI API调用：

### 1. 创建了专门的API工具函数
- `src/utils/aiApi.ts` - 包含了与DashScope API通信的所有逻辑
- 实现了错误处理、超时控制和响应解析
- 添加了友好的错误提示信息

### 2. 添加了配置管理系统
- `src/config/aiConfig.ts` - 集中管理所有AI相关配置
- 可通过配置文件控制是否使用真实API、调试模式等
- 添加了配置验证功能

### 3. 重构了AI数据生成逻辑
- 修改了`src/utils/statistics.ts`中的`generateAIData`函数
- 增加了参数支持真实API与模拟数据的切换
- 添加了调试日志功能

### 4. 增强了数据上下文管理
- 更新了`src/contexts/DataContext.tsx`中的`generateFromAI`函数
- 添加了配置验证步骤
- 改进了错误提示和用户反馈

### 5. 安装了必要的依赖
- 添加了`axios`库用于发送HTTP请求

## 如何正确配置AI API？

### 步骤1：修复.env文件

当前的.env文件中存在多个重复的`VITE_DASHSCOPE_API_KEY`定义，这可能导致配置问题。我已经创建了一个修复版本的.env文件：`.env.fixed`。

请按照以下步骤操作：

1. 备份当前的`.env`文件
2. 将`.env.fixed`重命名为`.env`
3. 检查并确认文件中的API密钥是否正确

### 步骤2：验证API密钥

确保您的API密钥是有效的：

1. 访问 https://dashscope.console.aliyun.com/
2. 登录您的阿里云账号
3. 检查您的API密钥是否有效
4. 如果需要，生成新的API密钥并更新到.env文件中

### 步骤3：调整配置选项（可选）

您可以在`src/config/aiConfig.ts`文件中调整以下配置选项：

- `USE_REAL_AI_API`: 设置为`true`启用真实API，`false`使用模拟数据
- `API_TIMEOUT`: 调整API调用的超时时间
- `DEBUG_MODE`: 设置为`true`启用详细的日志输出

## 如何验证配置是否正确？

1. 启动开发服务器：
   ```
   npm run dev
   ```

2. 打开应用程序并导航到"AI生成数据"部分

3. 输入一个数据生成提示（例如："生成100个服从正态分布的随机数，均值为10，标准差为2"）

4. 点击"生成数据"按钮

5. 如果配置正确，您将看到"真实AI生成数据"被添加到数据集列表中

6. 如果出现错误，请检查浏览器控制台中的错误信息，它会提供具体的问题和解决方案

## 常见问题及解决方案

### 1. API密钥无效或已过期

**错误信息**：`API密钥无效或已过期，请检查您的API密钥设置。`

**解决方案**：
- 访问 https://dashscope.console.aliyun.com/ 检查API密钥状态
- 生成新的API密钥并更新到.env文件中

### 2. API调用超时

**错误信息**：`API调用超时，请检查网络连接或稍后再试。`

**解决方案**：
- 检查您的网络连接
- 在`src/config/aiConfig.ts`中增加`API_TIMEOUT`值
- 稍后再试

### 3. API调用过于频繁

**错误信息**：`API调用过于频繁，请稍后再试。`

**解决方案**：
- 减少调用频率
- 稍后再试

### 4. 服务器暂时不可用

**错误信息**：`服务器暂时不可用，请稍后再试。`

**解决方案**：
- 稍后再试
- 检查阿里云通义千问服务的状态

## 注意事项

1. **API费用**：使用真实的DashScope API可能会产生费用，请参考阿里云的定价政策

2. **数据安全**：请妥善保管您的API密钥，不要在公开场合分享

3. **调用限制**：API可能有调用频率限制，请合理使用

4. **模拟数据回退**：如果API调用失败，系统会自动回退到使用模拟数据

如果您在配置过程中遇到任何问题，请参考浏览器控制台中的详细错误信息，或联系技术支持获取帮助。